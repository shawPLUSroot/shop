(()=>{var t={n:o=>{var r=o&&o.__esModule?()=>o.default:()=>o;return t.d(r,{a:r}),r},d:(o,r)=>{for(var n in r)t.o(r,n)&&!t.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:r[n]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o);const r=flarum.core.compat["common/app"];t.n(r)().initializers.add("shawplusroot/shop",(function(){console.log("[shawplusroot/shop] Hello, forum and admin!")}));const n=flarum.core.compat.extend,e=flarum.core.compat.app;var a=t.n(e);const s=flarum.core.compat["components/UserCard"];var i=t.n(s);const u=flarum.core.compat.Model;var l=t.n(u);const c=flarum.core.compat["models/User"];var p=t.n(c);function d(t,o){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},d(t,o)}function h(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,d(t,o)}const f=flarum.core.compat["common/components/Modal"];var y=t.n(f);const b=flarum.core.compat["common/components/Button"];var v=t.n(b),g=function(t){function o(){return t.apply(this,arguments)||this}h(o,t);var r=o.prototype;return r.className=function(){return"Modal--small"},r.title=function(){return a().translator.trans("shawplusroot-shop.lib.modal.purchase_detail")},r.content=function(){var t=this.attrs.invitationCode;return[m("div",{className:"Modal-body"},[m("p",a().translator.trans("shawplusroot-shop.lib.modal.instruction",{invitationCode:t})),m(".Form-group",v().component({type:"submit",className:"Button Button--primary",loading:this.loading},a().translator.trans("shawplusroot-shop.lib.modal.confirm")))])]},r.onsubmit=function(t){t.preventDefault(),this.hide(),this.loading=!1,location.reload()},o}(y()),w=function(t){function o(){for(var o,r=arguments.length,n=new Array(r),e=0;e<r;e++)n[e]=arguments[e];return(o=t.call.apply(t,[this].concat(n))||this).amount="",o.lastActivity="",o}h(o,t);var r=o.prototype;return r.className=function(){return"Modal--small"},r.title=function(){return"Confirm Purchase"},r.content=function(){var t=this;return m(".Modal-body",[m(".Form-group",[m("label",a().translator.trans("shawplusroot-shop.lib.modal.invite_code_amount")),m("input.FormControl",{type:"number",value:this.amount,onchange:function(o){t.amount=o.target.value},min:0,step:1,max:100,disabled:this.loading})]),m(".Form-group",v().component({type:"submit",className:"Button Button--primary",loading:this.loading,disabled:parseFloat(this.amount||"0")<=0},a().translator.trans("shawplusroot-shop.lib.modal.confirm")))])},r.request=function(t){return void 0===t&&(t=!1),a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/purchase",errorHandler:this.onerror.bind(this),headers:{"Content-Type":"application/json",Authorization:"Token "+a().session.token},body:{amount:this.amount,dryRun:t}})},r.onsubmit=function(t){var o=this;t.preventDefault(),this.loading=!0,this.request().then((function(t){if(t.success)return o.requestInviteCode();throw a().alerts.show({type:"error"},a().translator.trans("shawplusroot-shop.lib.modal.insufficient_money_alert")),new Error("Insufficient money")})).then((function(t){a().modal.show(g,{invitationCode:t.data.attributes.key})})).catch((function(t){o.loading=!1,m.redraw()}))},r.requestInviteCode=function(t){void 0===t&&(t=!1);var o=Math.random().toString(36).substring(2,10);return a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/getcustomcode",errorHandler:this.onerror.bind(this),headers:{"Content-Type":"application/json",Authorization:"Token "+a().session.token},body:{data:{attributes:{key:o,groupId:3,maxUses:this.amount,activates:!0}}}})},o}(y());a().initializers.add("shawplusroot/shop",(function(){p().prototype.purchase=l().attribute("purchase"),(0,n.extend)(i().prototype,"infoItems",(function(t){t.add("purchase",m("p",this.attrs.user.purchase())),a().session.user===this.attrs.user&&t.add("shop",m(".Form-group",v().component({className:"Button",onclick:function(){a().modal.show(w)}},a().translator.trans("shawplusroot-shop.forum.purchase"))))}))}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map