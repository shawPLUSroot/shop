{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@shawplusroot/shop/webpack/bootstrap","webpack://@shawplusroot/shop/webpack/runtime/compat get default export","webpack://@shawplusroot/shop/webpack/runtime/define property getters","webpack://@shawplusroot/shop/webpack/runtime/hasOwnProperty shorthand","webpack://@shawplusroot/shop/webpack/runtime/make namespace object","webpack://@shawplusroot/shop/external root \"flarum.core.compat['common/app']\"","webpack://@shawplusroot/shop/./src/common/index.ts","webpack://@shawplusroot/shop/external root \"flarum.core.compat['extend']\"","webpack://@shawplusroot/shop/external root \"flarum.core.compat['app']\"","webpack://@shawplusroot/shop/external root \"flarum.core.compat['components/UserCard']\"","webpack://@shawplusroot/shop/external root \"flarum.core.compat['Model']\"","webpack://@shawplusroot/shop/external root \"flarum.core.compat['models/User']\"","webpack://@shawplusroot/shop/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@shawplusroot/shop/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@shawplusroot/shop/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@shawplusroot/shop/external root \"flarum.core.compat['common/components/Button']\"","webpack://@shawplusroot/shop/./src/forum/ShowCodeModal.ts","webpack://@shawplusroot/shop/./src/forum/ConfirmPurchaseModal.ts","webpack://@shawplusroot/shop/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","import app from 'flarum/common/app';\n\napp.initializers.add('shawplusroot/shop', () => {\n  console.log('[shawplusroot/shop] Hello, forum and admin!');\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/UserCard'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['Model'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['models/User'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","import Modal from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\nimport app from 'flarum/app';\n\nexport default class ShowCodeModal extends Modal {\n    className() {\n        return 'Modal--small';\n    }\n\n    title() {\n        return app.translator.trans('shawplusroot-shop.lib.modal.purchase_detail');\n    }\n\n    content() {\n        const invitationCode = this.attrs.invitationCode;\n\n        return [\n            m('div', { className: 'Modal-body' }, [\n                m('p', \n                app.translator.trans('shawplusroot-shop.lib.modal.instruction',{\n                    invitationCode: invitationCode,\n                })),\n                m('.Form-group', Button.component({\n                    type: 'submit',\n                    className: 'Button Button--primary',\n                    loading: this.loading\n                }, \n                    app.translator.trans('shawplusroot-shop.lib.modal.confirm')\n                ))\n            ]),\n        ];\n    }\n\n    onsubmit(event: Event) {\n        event.preventDefault();\n        this.hide();\n        this.loading = false;\n        location.reload();\n    }\n}\n","import Modal from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\nimport app from 'flarum/app';\nimport ShowCodeModal from './ShowCodeModal';\n\nexport default class ConfirmPurchaseModal extends Modal {\n\n    amount = '';\n    lastActivity = '';\n\n    className() {\n        return 'Modal--small';\n    }\n\n    title() {\n        return 'Confirm Purchase';\n    }\n\n\n    content() {\n        return m('.Modal-body', [\n            m('.Form-group', [\n                m('label', \n                    app.translator.trans('shawplusroot-shop.lib.modal.invite_code_amount')\n                ),\n                m('input.FormControl', {\n                    type: 'number',\n                    value: this.amount,\n                    onchange: (event: InputEvent) => {\n                        this.amount = (event.target as HTMLInputElement).value;\n                    },\n                    min: 0,\n                    step: 1,\n                    max: 100,\n                    disabled: this.loading,\n                })\n            ]),\n      \n            m('.Form-group', Button.component({\n                type: 'submit',\n                className: 'Button Button--primary',\n                loading: this.loading,\n                disabled: parseFloat(this.amount || '0') <= 0,\n            }, \n                app.translator.trans('shawplusroot-shop.lib.modal.confirm')\n            ))\n        ]);\n    }\n\n    request(dryRun: boolean = false) {\n        return app.request<{ userMatchCount: number }>({\n            method: 'POST',\n            url: app.forum.attribute('apiUrl') + '/purchase',\n            errorHandler: this.onerror.bind(this),\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Token ${app.session.token}`\n            },\n            body: {\n                amount: this.amount,\n                dryRun,\n            },\n        });\n    }\n\n    onsubmit(event: Event) {\n        event.preventDefault();\n\n        this.loading = true;\n\n        this.request()\n        .then((payload) => {\n          if (payload.success) {\n            return this.requestInviteCode();\n          } else {\n            app.alerts.show({type: 'error'}, app.translator.trans('shawplusroot-shop.lib.modal.insufficient_money_alert'));\n            throw new Error('Insufficient money');\n          }\n        })\n        .then((response) => {\n          app.modal.show(ShowCodeModal, { invitationCode: response.data.attributes.key });\n        })\n        .catch((error) => {\n          this.loading = false;\n          m.redraw();\n        });\n      \n    }\n\n\n    requestInviteCode(dryRun: boolean = false) {\n        const key = Math.random().toString(36).substring(2, 10);\n        return app.request({\n          method: 'POST',\n          url: app.forum.attribute('apiUrl') + '/getcustomcode',\n          errorHandler: this.onerror.bind(this),\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Token ${app.session.token}`\n          },\n          body: {\n            data:{\n                attributes: {\n                    key: key,\n                    groupId: 3,\n                    maxUses: this.amount,\n                    activates: true\n                  }\n            }\n            \n          },\n        });\n      }\n      \n\n}\n\n\n","import { extend } from 'flarum/extend';\nimport app from 'flarum/app';\nimport UserCard from \"flarum/components/UserCard\";\nimport Model from \"flarum/Model\";\nimport User from \"flarum/models/User\";\nimport ConfirmPurchaseModal from './ConfirmPurchaseModal';\nimport Button from 'flarum/common/components/Button';\nimport PurchaseHistoryPage from './PurchaseHistoryPage';\nimport UserPage from 'flarum/components/UserPage';\n\napp.initializers.add('shawplusroot/shop', () => {\n\n  User.prototype.purchase = Model.attribute(\"purchase\");\n\n  // app.routes.userPurchaseHistory = {\n  //   path: '/u/:username/purchase',\n  //   component: PurchaseHistoryPage,\n  // };\n\n  // extend(UserPage.prototype, 'navItems', function (items) {\n  //   if (app.session.user === this.attrs.user) {\n  //       items.add('purchase-history', LinkButton.component({\n  //         href: app.route('userPurchaseHistory', {\n  //             username: this.user.slug(),\n  //         }),\n  //         icon: 'fas fa-receipt',\n  //     }, 'Purchase-History'));\n  //   }\n  // }); \n\n  extend(UserCard.prototype, \"infoItems\", function (items) {\n      items.add(\"purchase\", m('p', this.attrs.user.purchase()));\n      if (app.session.user === this.attrs.user) {\n          items.add(\"shop\", m('.Form-group', Button.component({\n            className: 'Button',\n            onclick() {\n                app.modal.show(ConfirmPurchaseModal);\n            },\n          },   app.translator.trans('shawplusroot-shop.forum.purchase'))));\n      }\n  });\n\n\n\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","app","add","console","log","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","ShowCodeModal","_Modal","apply","arguments","_proto","className","title","trans","content","invitationCode","this","attrs","m","Button","type","loading","onsubmit","event","preventDefault","hide","location","reload","Modal","ConfirmPurchaseModal","_this","_len","length","args","Array","_key","concat","amount","lastActivity","_this2","onchange","target","min","step","max","disabled","parseFloat","request","dryRun","method","url","attribute","errorHandler","onerror","headers","token","body","_this3","then","payload","success","requestInviteCode","show","Error","response","data","attributes","error","redraw","Math","random","toString","substring","groupId","maxUses","activates","User","purchase","Model","extend","UserCard","items","user","onclick"],"sourceRoot":""}